<html>

<head>
    <link href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.css" rel="stylesheet"
        type='text/css'>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
</head>
<script>
    var flag = false
    var flag2 = false;
    var fullName;
    var access_token;
    $(document).ready(function () {
        flag = localStorage.getItem('token')
        fullName = localStorage.getItem('user') ? localStorage.getItem('user') : false;
        access_token = localStorage.getItem('token') ? localStorage.getItem('token') : false;
        if (fullName) {
            $('#user_name').text("Hello" + " " + fullName)
            $('#logInfo').text('logOut')
            $('#cartImg').attr("href", `/view-cart?user=${access_token}`)
            $('#logInfo').attr("href", '/logout')
        } else {
            $('#logInfo').text('logIn')
            $('#logInfo').attr("href", '/login')
        }
        console.log(flag, fullName)
    })

    function cart(data) {
        if (flag) {
            var dataToSend = {
                product_id: data,
                quantity: 1,
                token: flag
            };

            $.ajax({
                type: "POST",
                url: "/cart",
                data: dataToSend,
                success: function (response) {
                    // Handle the response here
                    console.log(response);
                    window.location.assign(`/view-cart?user=${dataToSend.token}`);
                },
                error: function (xhr, status, error) {
                    // Handle errors here
                    console.log(xhr.responseText);
                }
            });

        } else {
            window.location.assign('/login');
        }

    }
</script>

<body>
    <br>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container">
            <a class="navbar-brand" href="/"><img
                    src="https://online.kfc.co.in/static/media/kfcLogo.492728c6.svg"></img></a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">

                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/view-item">Menu</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/deal">Deals</a>
                    </li>
                    <li class="nav-item">

                    </li>
                </ul>

            </div>
            <form class="form-inline my-2 my-lg-0">
                <p id="user_name" style="font-family: cursive;
    margin-bottom: 1px;"></p>

                <a class="nav-link mr-sm-2" id="logInfo" style="color:black"></a>
                {{!-- {{else}}
                <a class="nav-link mr-sm-2" style="color:black" href="/login">Login</a>
                {{/if}} --}}
                <a id="cartImg"> <img style="
    height: 49px;
    margin: -20px;cursor: pointer;
" src="https://images.ctfassets.net/wtodlh47qxpt/6qtBVFuno7pdwOQ9RIvYm9/d13e9b7242980972cf49beddde2cc295/bucket_cart_icon.svg"></img></a>

            </form>
        </div>
        </div>
    </nav>
    <div>
        <div class="container-fluids" style="
    background-color: black;
    padding: 15px;">
            <p style="text-align: center; color:white;"><i class="fa fa-map-marker" aria-hidden="true"></i> Delivery to:
                Church Road, Paneer Nagar, Mogappair, Chennai, Tamil Nadu</p>
        </div>
    </div>
    <div class="container" style="margin-top: 53px;">
        <div class="row">
            <div class="col-sm-12 col-lg-3">
                <h2 style="font-family: cursive;">KFC MENU</h2>
                <hr>
                <br>
                <ul class="list-group">
                    {{#each cat}}
                    <a href="/view-item/?item={{this._id}}">
                        <li class=" bor list-group-item "
                            style="color:black; text-transform: capitalize; font-family:cursive;">{{this.name}}</li>
                    </a>

                    {{/each}}
                </ul>
            </div>
            <div class="col-sm-12 col-lg-9">
                <h2 style="font-family: cursive; text-align:center;">Items</h2>
                <hr>
                <div class="search-container">
                    <form action="/view-item">
                        <input type="text" class="serIn" placeholder="Search Menu" name="itemName">
                        <button type="submit" class="serBut"><i class="fa fa-search"></i></button>
                    </form>
                </div>

                <br>
                {{#if count}}
                <div class="container">
                    <div class="row">
                        {{#each item}}
                        <div style="margin-top: 10px;" class="col-sm">
                            <div class="card" style="width: 18rem;">
                                <img src={{this.item_image}} class="card-img-top" style="height: 250px;" alt="...">
                                <div class="card-body">
                                    <h5 class="card-title">{{this.item_name}}</h5>
                                    <p>Non veg</p>
                                    <p class="card-text">₹ {{this.item_rate}}</p>
                                    <button style="border-radius: 30px;" type="submit" id="cartFun"
                                        onclick="cart('{{this._id}}')" class="btn btn-danger">add to
                                        cart</button>
                                </div>
                            </div>
                        </div>
                        {{/each}}
                    </div>
                </div>
                {{else}}
                <div class="container">
                    <div class="row justify-content-center">
                        <div class="col-md-8">
                            <div class="cart-empty">
                                <img style="    width: 300px;height: 300px;"
                                    src="https://media2.giphy.com/media/aQIcNODy7lBOdWkicY/giphy.gif?cid=6c09b952fd0a89fd5b7334efaab3b5833cc7ea9fa6f604e4&rid=giphy.gif&ct=s"
                                    alt="Empty Cart">
                                <h2 class="para">Your Item is Empty</h2>
                            </div>
                        </div>
                    </div>
                </div>
                {{/if}}
            </div>
        </div>

    </div>

</body>
<footer class="bg-light py-3 footer">
    <div class="container">
        <p class="text-center"><img
                src="//images.ctfassets.net/wtodlh47qxpt/25FSYFuEtGct8NSrtpKe6d/b602f6fe0bf294e6a6dff5d7648bf594/KFC_Logo.svg"></img>
            Copyright © KFC Corporation 2021 All Rights Reserved</p>
    </div>
</footer>
<style>
    .bor {
        border: none;
    }

    .para {
        font-family: cursive;
        text-align: center;
    }

    .search-container {
        display: flex;
        margin-top: 20px;
    }

    .serIn {
        width: 260px;
        height: 40px;
        padding: 10px;
        border-radius: 20px;
        border: none;
        font-size: 16px;
        box-shadow: 0px 2px 10px rgba(0, 0, 0, 0.1);
    }

    .serBut {
        height: 40px;
        width: 60px;
        border-radius: 20px;
        border: none;
        background-color: black;
        color: white;
        font-size: 16px;
        margin-left: -50px;
        box-shadow: 0px 2px 10px rgba(0, 0, 0, 0.1);
    }

    .fa-search {
        font-size: 20px;
    }
</style>

</html>