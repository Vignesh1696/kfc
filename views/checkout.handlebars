<html>

<head>
    <link href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.css" rel="stylesheet"
        type='text/css'>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
</head>

<script>
    var usr = {{{user}}}
    var cart = {{{cart}}}
    var itemss = cart.items
    console.log("cart", itemss)
    var flag = false
    var flag2 = false;
    var fullName;
    var access_token;
    var totAmout;
    var subAmount;
    $(document).ready(function () {
        flag = localStorage.getItem('token')
        totAmout = localStorage.getItem('totAmount');
        subAmount = localStorage.getItem('subAmount');
        fullName = localStorage.getItem('user') ? localStorage.getItem('user') : false;
        access_token = localStorage.getItem('token') ? localStorage.getItem('token') : false;
        if (fullName) {
            $('#subAmount').text(subAmount)
            $('#totAmount').text(totAmout)
            $('#user_name').text("Hello" + " " + fullName)
            $('#logInfo').text('logOut')
            $('#cartImg').attr("href", `/view-cart?user=${access_token}`)
            $('#cartImg2').attr("href", `/view-cart?user=${access_token}`)
            $('#logInfo').attr("href", '/logout')
        } else {
            $('#logInfo').text('logIn')
            $('#logInfo').attr("href", '/login')
        }
        console.log(flag, fullName)
    })

    console.log("dddddddddd",typeof localStorage.getItem('totAmount'))
    var options = {
        "key": "rzp_test_mVjfIxanXColF7",
        "amount": Math.abs(parseInt(localStorage.getItem('totAmount'))),
        "currency": "INR",
        "name": usr.username,
         "description": "Pay & Checkout this Course, Upgrade your DSA Skill",
        "image": "https://media.geeksforgeeks.org/wp-content/uploads/20210806114908/dummy-200x200.png",
        "handler": function (response) {
            var no = Math.floor(Math.random()*90000) + 10000;
            var payload = {
                "order_no":no,
                "order_type":"take",
                "total":localStorage.getItem('totAmount'),
                "items":cart._id,
                "user_details":{
                    "name":document.forms["myForm"]["name"].value,
                    "email":document.forms["myForm"]["email"].value,
                    "phone":document.forms["myForm"]["phone"].value,
                    "address":document.forms["myForm"]["address"].value,
                    "city":document.forms["myForm"]["city"].value,
                },
                "user_id":usr._id,
                "status":"pending"
            }
             payload["items"] = [];
            for(let data of cart.items){
                payload["items"].push({
                    "item":data.item,
                    "quantity":data.quantity
                })
            }
            $.ajax({
                type: "POST",
                url: "/create-order",
                data: payload,
                success: function (response) {
                    // Handle the response here
                    console.log(response);
                    window.location.assign('/order');
                },
                error: function (xhr, status, error) {
                    // Handle errors here
                    console.log(xhr.responseText);
                }
            });
        },
        "prefill": {
            //Here we are prefilling random contact
            "contact": "9500150893",
            //name and email id, so while checkout
            "name":usr.username,
            "email": usr.email,
        },
        "notes": {
            "description": "Best Course for SDE placements",
            "language": "Available in 4 major Languages JAVA, C/C++, Python, Javascript",
            "access": "This course have Lifetime Access"
        },
        "theme": {
            "color": "#2300a3"
        }
    };

   

    var razorpayObject = new Razorpay(options);
    console.log("ddddd", razorpayObject);
    razorpayObject.on('payment.failed', function (response) {
        console.log("vvvvvvvvvvvvvv", response);
        alert("This step of Payment Failed");
    });


    function pay() {
        console.log("payyy")
        razorpayObject.open();

    }

    function validateForm() {
        let name = document.forms["myForm"]["name"].value;
        let email = document.forms["myForm"]["email"].value;
        let address = document.forms["myForm"]["address"].value;
        let city = document.forms["myForm"]["city"].value;
        let state = document.forms["myForm"]["state"].value;
        let zip = document.forms["myForm"]["zip"].value;
        let phone = document.forms["myForm"]["phone"].value;

        if (name == "") {
            $("#name-valid").text("please add name");
            return false;
        }

        else if (address == "") {
            $("#address-valid").text("please add address");
            return false;
        }
        else if (city == "") {
            $("#city-valid").text("please add city");
            return false;
        }
        else if (state == "") {
            $("#state-valid").text("please add state");
            return false;
        }
        else if (zip == "") {
            $("#zip-valid").text("please add zip");
            return false;
        }
        else if (phone == "") {
            $("#phone-valid").text("please add phone");
            return false;
        } else if (email == "") {
            $("#email-valid").text("please add email");
            return false;
        } else {
            console.log("ssssspay")
            pay();
        }
    }



</script>

<body>
    <br>
    <div class="container">
        <nav class="navbar navbar-expand-lg navbar-light bg-light">

            <a class="navbar-brand" href="/"><img
                    src="https://online.kfc.co.in/static/media/kfcLogo.492728c6.svg"></img></a>
            {{!-- <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button> --}}
            <div class="collapse navbar-collapse" id="navbarNav">
                {{!-- <ul class="navbar-nav">
                    <li class="nav-item">

                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="cartImg"> <-- Back to Cart</a>
                    </li>
                </ul> --}}

            </div>
            <form class="form-inline my-2 my-lg-0">
                <p id="user_name" style="font-family: cursive;
    margin-bottom: 1px;"></p>

                <a class="nav-link mr-sm-2" id="logInfo" style="color:black"></a>
                {{!-- {{else}}
                <a class="nav-link mr-sm-2" style="color:black" href="/login">Login</a>
                {{/if}} --}}
                <a id="cartImg"> <img style="
    height: 49px;
    margin: -20px;cursor: pointer;
" src="https://images.ctfassets.net/wtodlh47qxpt/6qtBVFuno7pdwOQ9RIvYm9/d13e9b7242980972cf49beddde2cc295/bucket_cart_icon.svg"></img></a>

            </form>

    </div>
    </nav>
    </div>
    <hr>
    <div class="container-fluids" style="
    background-color: black;
    padding: 18px;">
        <p style="text-align: center; color:white;"><i class="fa fa-map-marker" aria-hidden="true"></i> Delivery to:
            Church Road, Paneer Nagar, Mogappair, Chennai, Tamil Nadu</p>
    </div>

    <div class="container" style="margin-top: 50px;">
        <a style="font-family: cursive; color: black; font-size: 20px;" id="cartImg2">
            <-- Back to Cart </a>
                <h2 style="font-family: cursive; font-size: 37px;">Check Out</h2>

                <hr>
    </div>
    <br>
    <div class="container mb-5">
        <form name="myForm" onsubmit="event.preventDefault(); validateForm()">
            <div class="row">
                <div class="col-sm-12 col-lg-8">
                    <div class="clearfix col">


                        <div style="border-radius: 25px;background-color: whitesmoke;padding: 30px;">
                            <h2 style="font-family: cursive;">User Info</h2>
                            <br>
                            <div class="row mb-3">
                                <div class="col-md-9">
                                    <div class="form-group">
                                        <div class="form-outline w-50">
                                            <input type="text" class="form-control" id="name" name="name"
                                                placeholder="Name">
                                        </div>
                                        <span id="name-valid" class="error"></span>
                                    </div>

                                </div>
                            </div>
                            <div class="mb-3">
                                <textarea class="form-control" name="address" id="address" rows="3"
                                    placeholder="Enter address"></textarea>
                                <span id="address-valid" class="error"></span>
                            </div>
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <div class="form-outline w-50">

                                        <input type="text" class="form-control" name="city" placeholder="City">
                                        <span id="city-valid" class="error"></span>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-outline w-50">

                                        <input type="text" class="form-control" name="state" placeholder="State">
                                        <span id="state-valid" class="error"></span>
                                    </div>
                                </div>
                            </div>
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <div class="form-outline w-50">

                                        <input type="text" class="form-control" name="zip" placeholder="Zip code">
                                        <span id="zip-valid" class="error"></span>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-outline w-50">

                                        <input type="text" class="form-control" name="country" placeholder="Country">
                                        <span id="country-valid" class="error"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <br>

                        <div style="border-radius: 25px;background-color: whitesmoke;padding: 30px;">
                            <h2 style="font-family: cursive;">Contact Info</h2>
                            <br>
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <div class="form-outline w-50">

                                        <input type="text" class="form-control" name="phone" placeholder="Phone">
                                        <span id="phone-valid" class="error"></span>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-outline w-50">

                                        <input type="text" class="form-control" name="email" placeholder="Email">
                                        <span id="email-valid" class="error"></span>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
                <div class=" col-sm-12 col-lg-4">
                    <div class="card justify-content-lg-center"
                        style="margin-top:40px;margin-bottom:34px;border-radius: 13px;box-shadow: 10px 5px 5px #d3c6c6;">
                        <div class="card-body" style="background-color: whitesmoke;text-align: center;">
                            <h5 class="card-title" style="    font-weight: 800;">{{count}} Items</h5>
                            <p class="para pull-left mb-2">SubTotal</p>
                            <p class=" para card-text" id="subAmount" style="margin-left: 165px;"></p>
                            <p class="para pull-left mb-2">GST</p>
                            <p class="para card-text" style="margin-left: 165px;">$30</p>
                            <p class="para pull-left mb-2">Resturant fees</p>
                            <p class="para card-text" style=" margin-left: 165px;">$40</p>
                            <hr>
                            <p class="para pull-left mb-2">Total Bill</p>
                            <p class="para card-text" id="totAmount" style=" margin-left: 165px;"></p>
                            <br>
                            <button type="submit" id="pay-button" style="border-radius: 55px;"
                                class="btn btn-danger btn-lg btn-block">Payment</button>


                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>

</body>
<footer class="bg-light py-3">
    <div class="container">
        <p class="text-center"><img
                src="//images.ctfassets.net/wtodlh47qxpt/25FSYFuEtGct8NSrtpKe6d/b602f6fe0bf294e6a6dff5d7648bf594/KFC_Logo.svg"></img>
            Copyright © KFC Corporation 2021 All Rights Reserved</p>
    </div>
</footer>
<style>
    .input-group-addon {
        max-width: 42px;
        text-align: center;
        background: none;
        border-bottom: 1px solid #ced4da;
        padding-right: 5px;
        border-radius: 0;
    }

    .form-group {
        margin-bottom: 20px;
    }

    label {
        font-weight: normal;
        font-size: 13px;
    }

    .form-control {
        min-height: 38px;
        padding-left: 5px;
        box-shadow: none !important;
        border-width: 0 0 1px 0;
        border-radius: 0;
    }

    .form-control:focus {
        border-color: #ccc;
    }

    .error {
        color: red;
        text-shadow: 105 110 black;
        font-size: smaller;
        text-shadow: 1px 1px 2px red, 0 0 1em #ff0036;
    }
</style>

</html>